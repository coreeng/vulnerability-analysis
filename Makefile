
.PHONY: default
default: help

.PHONY: help
help: Makefile
	@echo "Usage: "
	@sed -n 's/^##[ -]/   /p' Makefile
	@echo ""


## make build					Build golang app
.PHONY: build
build: 
	go build -o vulcheck ./cmd/vulnerability-analysis/main.go
## make test					Run unit tests for golang app
.PHONY: test
test: build
	@go test ./... -cover -coverprofile=coverage.out
run: build 
	./vulcheck trivy argocd index.docker.io/bitnami/etcd:3.5.12-debian-11-r3
## make apply-test-resources Applies test resources. These include the trivy CRDs and test resources
.PHONY: apply-test-resources 
apply-test-resources: 
	@kubectl apply -f ./testdata/crds/ ; \
	kubectl apply -f ./testdata/resources/  || true

.PHONY: fmt
fmt: ## Run go fmt against code.
	go fmt ./...
