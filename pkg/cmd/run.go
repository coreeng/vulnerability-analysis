package cmd

import (
	"errors"
	vaerror "github.com/coreeng/vulnerability-analysis/pkg/error"
	log "github.com/sirupsen/logrus"

	"github.com/coreeng/vulnerability-analysis/pkg/root"
)

const (
	SuccessErrorStatus  = 0
	FailedErrorStatus   = 1
	InternalErrorStatus = 2
)

func Run() int {

	rootCmd, err := root.NewRootCmd()
	if err != nil {
		return handleError(err)
	}
	err = rootCmd.Execute()
	if err != nil {
		return handleError(err)
	}
	return SuccessErrorStatus
}

func handleError(err error) int {
	log.Errorf("Error received:\n%s", err.Error())
	ok := errors.As(err, &vaerror.ValidationFailedError{})
	if ok {
		return FailedErrorStatus
	}
	return InternalErrorStatus
}
