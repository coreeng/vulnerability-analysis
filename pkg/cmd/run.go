package cmd

import (
	"errors"

	vaerror "github.com/coreeng/vulnerability-analysis/pkg/error"
	log "github.com/sirupsen/logrus"

	"github.com/coreeng/vulnerability-analysis/pkg/root"
)

const (
	// SuccessErrorStatus Return code if check succeeds
	SuccessErrorStatus = 0
	// FailedErrorStatus Return code if check fails
	FailedErrorStatus = 1
	// InternalErrorStatus Return code if any other error occurs
	InternalErrorStatus = 2
)

// Run the tool
func Run() int {

	rootCmd, err := root.NewRootCmd()
	if err != nil {
		return handleError(err)
	}
	err = rootCmd.Execute()
	if err != nil {
		return handleError(err)
	}
	return SuccessErrorStatus
}

func handleError(err error) int {
	log.Errorf("Error received:\n%s", err.Error())
	ok := errors.As(err, &vaerror.ValidationFailedError{})
	if ok {
		return FailedErrorStatus
	}
	return InternalErrorStatus
}
