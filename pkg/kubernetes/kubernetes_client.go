package kubernetes

import (
	"sync"

	ctrl "sigs.k8s.io/controller-runtime"

	log "github.com/sirupsen/logrus"
	"k8s.io/client-go/dynamic"
)

var lock = &sync.Mutex{}

var clientInstance *dynamic.DynamicClient

func GetClient() *dynamic.DynamicClient {
	if clientInstance == nil {
		lock.Lock()
		defer lock.Unlock()
		if clientInstance == nil {
			log.Info("Creating k8s client instance.")

			config := ctrl.GetConfigOrDie()
			clientInstance = dynamic.NewForConfigOrDie(config)

		} else {
			log.Info("Client instance already created.")
		}

	} else {
		log.Info("Client instance already created.")
	}
	return clientInstance
}
